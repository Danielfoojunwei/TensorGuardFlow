<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TensorGuard Control Center</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-layout">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="brand">
                <div class="logo-icon">üõ°Ô∏è</div>
                <h1>TensorGuard</h1>
            </div>
            <ul class="nav-links">
                <li class="active" data-view="overview">
                    <span class="icon">üìä</span> Overview
                </li>
                <li data-view="settings">
                    <span class="icon">‚öôÔ∏è</span> Settings
                </li>
                <li data-view="usage">
                    <span class="icon">üìà</span> Usage
                </li>
                <li data-view="versions">
                    <span class="icon">üìú</span> Versions
                </li>
            </ul>
            <div class="sidebar-footer">
                <div id="simd-badge" class="simd-badge hidden">SIMD</div>
                <p>v2.0.0-FedMoE</p>
            </div>
        </nav>

        <!-- Main Content Area -->
        <div class="main-content">
            <header>
                <div class="view-title">
                    <h2 id="current-view-name">Overview</h2>
                </div>
                <div class="status-badge" id="connection-status">
                    <span class="dot"></span> <span id="conn-text">Connecting...</span>
                </div>
            </header>

            <!-- View: Overview -->
            <section id="view-overview" class="view-container active">
                <div class="dashboard-grid">
                    <!-- Existing Telemetry Card -->
                    <div class="card main-card">
                        <h3>Real-Time Fleet Telemetry</h3>
                        <p class="subtitle">Zone: <strong>Manufacturing A</strong></p>

                        <div class="encryption-viz">
                            <div class="secure-line">
                                <div class="icon robot">ü§ñ</div>
                                <div class="pipeline">
                                    <div class="stage" title="Gradient Clipping">‚úÇÔ∏è</div>
                                    <div class="arrow">‚Üí</div>
                                    <div class="stage" title="Sparsification">üìâ</div>
                                    <div class="arrow">‚Üí</div>
                                    <div class="stage" title="APHE Compression">üì¶</div>
                                    <div class="arrow">‚Üí</div>
                                    <div class="stage lock" title="N2HE Encryption">üîí</div>
                                </div>
                                <div class="icon cloud">‚òÅÔ∏è</div>
                            </div>
                        </div>

                        <div class="stats-grid">
                            <div class="stat-item">
                                <span class="label">Submissions</span>
                                <span class="value" id="submission-count">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="label">Saved Bandwidth</span>
                                <span class="value highlight" id="saved-mb">-</span>
                            </div>
                        </div>

                        <div class="telemetry-section">
                            <div class="telemetry-grid">
                                <div class="telemetry-card">
                                    <span class="tel-label">Train</span>
                                    <span class="tel-value" id="lat-train">-</span>
                                </div>
                                <div class="telemetry-card">
                                    <span class="tel-label">Compress</span>
                                    <span class="tel-value" id="lat-compress">-</span>
                                </div>
                                <div class="telemetry-card">
                                    <span class="tel-label">Encrypt</span>
                                    <span class="tel-value" id="lat-encrypt">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MoI Section (v2.0) -->
                    <div class="card experts-card">
                        <h3>Mixture of Intelligence (MoI)</h3>
                        <div class="moi-grid" id="moi-grid">
                            <div class="expert-placeholder">Analyzing task instructions...</div>
                        </div>
                        <div class="experts-explanation">
                            <p>Instruction-Aware Gating (IOSP) dynamically activates task-critical experts, minimizing
                                parameter interference and stabilizing global convergence.</p>
                        </div>
                    </div>

                    <!-- Budget & Security -->
                    <div class="card security-card">
                        <h3>Privacy & Security</h3>
                        <div class="budget-section">
                            <div class="budget-header">
                                <span class="label">Privacy Budget (Œµ)</span>
                                <span class="value" id="budget-val">5.00</span>
                            </div>
                            <div class="progress-bar-bg">
                                <div class="progress-bar-fill" id="budget-fill"></div>
                            </div>
                        </div>

                        <div class="key-status-mini">
                            <span id="key-path" class="key-path">keys/enterprise_key.npy</span>
                            <span id="key-badge" class="badge">Checking...</span>
                        </div>
                        <button id="btn-gen-key" class="btn tertiary">Rotate Key</button>
                    </div>

                    <!-- Audit Log -->
                    <div class="card audit-card">
                        <h3>Security Audit Log</h3>
                        <div id="audit-log" class="audit-log">
                            <div class="audit-entry empty">No security events recorded.</div>
                        </div>
                    </div>
                </div>

                <!-- Global Controls -->
                <div class="global-controls">
                    <button id="btn-start" class="btn primary">Resume Federation</button>
                    <button id="btn-stop" class="btn secondary" disabled>Pause</button>
                </div>
            </section>

            <!-- View: Settings -->
            <section id="view-settings" class="view-container">
                <div class="card settings-card">
                    <h3>System Parameters</h3>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label for="set-epsilon">Privacy Epsilon (Œµ)</label>
                            <input type="number" id="set-epsilon" value="1.0" step="0.1" title="Privacy Epsilon">
                        </div>
                        <div class="setting-item">
                            <label for="set-rank">LoRA Rank</label>
                            <select id="set-rank" title="LoRA Rank">
                                <option value="8">8 (Efficient)</option>
                                <option value="16">16 (Standard)</option>
                                <option value="32" selected>32 (High Capacity)</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="set-sparsity">Grad Sparsity (%)</label>
                            <input type="range" id="set-sparsity" min="0.1" max="5.0" step="0.1" value="1.0"
                                title="Grad Sparsity">
                            <span id="sparsity-val">1.0%</span>
                        </div>
                        <div class="setting-item">
                            <label for="set-gating">Expert Gating Threshold</label>
                            <input type="number" id="set-gating" value="0.15" step="0.01" min="0" max="1"
                                title="Minimum relevance for expert activation">
                        </div>
                        <div class="setting-item">
                            <label for="set-outlier">Outlier Sensitivity (MAD)</label>
                            <input type="number" id="set-outlier" value="3.0" step="0.5" min="1.0" max="10.0"
                                title="MAD multiplier for Byzantine rejection">
                        </div>
                        <div class="setting-item">
                            <label>Security Level</label>
                            <span class="badge locked">PQ-128 (N2HE)</span>
                        </div>
                    </div>
                    <button class="btn primary" id="btn-save-settings">Apply Changes</button>
                </div>

                <!-- KMS/HSM Configuration -->
                <div class="card kms-card">
                    <h3>üîê Key Management System (KMS/HSM)</h3>
                    <div class="kms-status-bar">
                        <span class="kms-provider-label">Provider:</span>
                        <span id="kms-provider-status" class="badge">Local</span>
                        <span id="kms-connection-dot" class="dot status-local"></span>
                        <span id="kms-connection-text">Using local key storage</span>
                    </div>

                    <div class="settings-grid">
                        <div class="setting-item full-width">
                            <label for="kms-provider">KMS Provider</label>
                            <select id="kms-provider" title="Key Management Service Provider">
                                <option value="local" selected>üóÑÔ∏è Local (File-based)</option>
                                <option value="aws">‚òÅÔ∏è AWS KMS</option>
                                <option value="azure">üî∑ Azure Key Vault</option>
                                <option value="gcp">üåê GCP Cloud KMS</option>
                            </select>
                        </div>

                        <!-- AWS KMS Config (hidden by default) -->
                        <div id="kms-aws-config" class="kms-provider-config hidden">
                            <div class="setting-item">
                                <label for="aws-region">AWS Region</label>
                                <select id="aws-region">
                                    <option value="us-east-1">us-east-1</option>
                                    <option value="us-west-2">us-west-2</option>
                                    <option value="eu-west-1">eu-west-1</option>
                                    <option value="ap-southeast-1">ap-southeast-1</option>
                                </select>
                            </div>
                            <div class="setting-item">
                                <label for="aws-cmk-arn">CMK ARN</label>
                                <input type="text" id="aws-cmk-arn" placeholder="arn:aws:kms:region:account:key/id">
                            </div>
                        </div>

                        <!-- Azure Key Vault Config (hidden by default) -->
                        <div id="kms-azure-config" class="kms-provider-config hidden">
                            <div class="setting-item">
                                <label for="azure-vault-url">Vault URL</label>
                                <input type="text" id="azure-vault-url" placeholder="https://myvault.vault.azure.net">
                            </div>
                            <div class="setting-item">
                                <label for="azure-key-name">Key Name</label>
                                <input type="text" id="azure-key-name" placeholder="tensorguard-key">
                            </div>
                        </div>

                        <!-- GCP Cloud KMS Config (hidden by default) -->
                        <div id="kms-gcp-config" class="kms-provider-config hidden">
                            <div class="setting-item">
                                <label for="gcp-project">Project ID</label>
                                <input type="text" id="gcp-project" placeholder="my-project-123">
                            </div>
                            <div class="setting-item">
                                <label for="gcp-location">Location</label>
                                <input type="text" id="gcp-location" placeholder="global" value="global">
                            </div>
                            <div class="setting-item">
                                <label for="gcp-keyring">Key Ring</label>
                                <input type="text" id="gcp-keyring" placeholder="tensorguard-keyring">
                            </div>
                            <div class="setting-item">
                                <label for="gcp-keyname">Key Name</label>
                                <input type="text" id="gcp-keyname" placeholder="fleet-encryption-key">
                            </div>
                        </div>
                    </div>

                    <div class="kms-actions">
                        <button class="btn secondary" id="btn-test-kms">üîó Test Connection</button>
                        <button class="btn primary" id="btn-save-kms">üíæ Save KMS Config</button>
                    </div>

                    <!-- KMS Audit Log -->
                    <div class="kms-audit-section">
                        <h4>üìú Key Audit Log</h4>
                        <div id="kms-audit-log" class="audit-log">
                            <div class="audit-entry">
                                <span class="timestamp">2025-12-28 12:00:00</span>
                                <span class="event">KEY_REGISTERED</span>
                                <span class="details">fleet_v1 (128-bit N2HE)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- View: Usage -->
            <section id="view-usage" class="view-container">
                <div class="card usage-card">
                    <h3>Fleet Analytics</h3>
                    <div class="analytics-metrics">
                        <div class="metric">
                            <span class="label">Total Bandwidth Saved</span>
                            <span class="value">412.5 GB</span>
                        </div>
                        <div class="metric">
                            <span class="label">Avg Aggregation Time</span>
                            <span class="value">1.4s</span>
                        </div>
                    </div>
                    <div class="chart-placeholder">
                        <p>Usage chart visualization placeholder...</p>
                    </div>
                </div>
            </section>

            <!-- View: Versions -->
            <section id="view-versions" class="view-container">
                <div class="card versions-card">
                    <h3>Model Version History</h3>
                    <table class="versions-table">
                        <thead>
                            <tr>
                                <th>Version</th>
                                <th>Timestamp</th>
                                <th>Status</th>
                                <th>Quality (MSE)</th>
                            </tr>
                        </thead>
                        <tbody id="version-history-body">
                            <!-- Dynamic rows -->
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>

    <footer>
        <p>Enterprise Management Portal | Powered by APHE & N2HE | <span class="security-badge">üîí CSPRNG + msgpack
                (v2.0 Hardened)</span></p>
    </footer>

    <script src="app.js"></script>
</body>

</html>