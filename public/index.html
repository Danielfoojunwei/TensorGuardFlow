<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TensorGuard Enterprise PLM</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Tailwind CSS (Dev CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                }
            }
        }
    </script>
    <link rel="stylesheet" href="styles.css">
</head>

<body x-data="app()" x-init="init()" class="antialiased min-h-screen">

    <div class="main-grid">
        <!-- Sidebar -->
        <aside class="bg-[#0f0f17] border-r border-white/5 flex flex-col p-6 fixed h-full w-[260px]">
            <div class="flex items-center gap-3 mb-10 overflow-hidden">
                <div
                    class="w-8 h-8 rounded-lg bg-sky-500 flex-shrink-0 flex items-center justify-center text-white font-bold">
                    T</div>
                <div class="flex flex-col">
                    <span class="font-bold text-sm tracking-tight">TensorGuard</span>
                    <span class="text-[10px] text-white/40 uppercase tracking-widest font-semibold">Enterprise
                        PLM</span>
                </div>
            </div>

            <nav class="space-y-1 flex-1">
                <div @click="activeTab = 'dashboard'" class="sidebar-link"
                    :class="{'active': activeTab === 'dashboard'}">
                    <i data-lucide="layout-dashboard"></i> <span>Dashboard</span>
                </div>
                <div @click="activeTab = 'lineage'" class="sidebar-link" :class="{'active': activeTab === 'lineage'}">
                    <i data-lucide="git-branch"></i> <span>Model Lineage</span>
                </div>
                <div @click="activeTab = 'compliance'" class="sidebar-link"
                    :class="{'active': activeTab === 'compliance'}">
                    <i data-lucide="shield-check"></i> <span>Compliance Registry</span>
                </div>
                <div @click="activeTab = 'vault'" class="sidebar-link" :class="{'active': activeTab === 'vault'}">
                    <i data-lucide="key"></i> <span>Key Vault</span>
                </div>
                <div @click="activeTab = 'audit'" class="sidebar-link" :class="{'active': activeTab === 'audit'}">
                    <i data-lucide="clipboard-list"></i> <span>Audit Trail</span>
                </div>
            </nav>

            <div class="border-t border-white/5 pt-6 mt-6">
                <div class="flex items-center gap-3 px-2">
                    <div
                        class="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center text-xs font-bold text-sky-400">
                        DF</div>
                    <div class="flex flex-col">
                        <span class="text-xs font-semibold">Daniel Foo</span>
                        <span class="text-[10px] text-white/30 truncate max-w-[140px]">ORG_ADMIN</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content (Spacer for fixed sidebar) -->
        <div class="col-start-2">
            <header
                class="h-16 border-b border-white/5 flex items-center px-10 sticky top-0 bg-[#0a0a0f]/80 backdrop-blur z-40 justify-between">
                <div class="flex items-center gap-2 text-xs text-white/40 font-mono">
                    <span>SYSTEM_TIME</span>
                    <span class="text-white/60" x-text="currentTime"></span>
                    <span class="mx-2">|</span>
                    <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
                    <span class="text-emerald-500">PRODUCTION READY</span>
                </div>
                <div class="flex items-center gap-4">
                    <button
                        class="bg-white/5 hover:bg-white/10 px-3 py-1.5 rounded-md text-xs font-medium border border-white/10 transition-colors">Export
                        Report</button>
                    <button
                        class="bg-sky-600 hover:bg-sky-500 px-3 py-1.5 rounded-md text-xs font-medium transition-colors shadow-lg shadow-sky-600/20">New
                        Enablement Run</button>
                </div>
            </header>

            <main class="content-area">
                <!-- Dashboard Tab -->
                <div x-show="activeTab === 'dashboard'" x-transition x-cloak>
                    <div class="grid grid-cols-4 gap-6 mb-10">
                        <!-- Active Identifiers Card -->
                        <div class="plm-card gradient-card-blue">
                            <span class="text-[10px] text-white/60 uppercase font-bold tracking-wider mb-1 block">Active
                                Identifiers</span>
                            <template x-if="loading.stats">
                                <div class="skeleton h-8 w-20 mt-2"></div>
                            </template>
                            <template x-if="!loading.stats && !errors.stats">
                                <div class="flex items-end gap-2">
                                    <span class="text-3xl font-bold font-mono"
                                        x-text="endpoints.length || certificates.length || 14"></span>
                                    <span class="text-emerald-400 text-xs mb-1 flex items-center gap-1">
                                        <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse"></span>
                                        Live Seats
                                    </span>
                                </div>
                            </template>
                            <template x-if="errors.stats">
                                <div class="text-red-400 text-xs mt-2 flex items-center gap-1">
                                    <i data-lucide="alert-circle" class="w-3 h-3"></i>
                                    <span x-text="errors.stats"></span>
                                </div>
                            </template>
                        </div>

                        <!-- Model Lineage Card -->
                        <div class="plm-card gradient-card-purple">
                            <span class="text-[10px] text-white/60 uppercase font-bold tracking-wider mb-1 block">Model
                                Lineage Score</span>
                            <div class="flex items-end gap-2">
                                <span class="text-3xl font-bold font-mono">99.8</span>
                                <span class="text-violet-400 text-xs mb-1">% Authenticated</span>
                            </div>
                        </div>

                        <!-- Privacy Budget Card with Chart -->
                        <div class="plm-card gradient-card-amber relative overflow-hidden">
                            <span
                                class="text-[10px] text-white/60 uppercase font-bold tracking-wider mb-1 block">Privacy
                                Budget</span>
                            <div class="flex items-center gap-3">
                                <div class="w-16 h-16">
                                    <canvas id="privacyChart"></canvas>
                                </div>
                                <div>
                                    <span class="text-2xl font-bold font-mono"
                                        x-text="'Îµ ' + ((stats.privacy_cap || 10) - (stats.privacy_consumed || 1.6)).toFixed(1)"></span>
                                    <div class="text-[10px] text-white/40">Remaining</div>
                                </div>
                            </div>
                        </div>

                        <!-- NEW: Triple-Trust Matrix Card -->
                        <div class="plm-card gradient-card-green relative group overflow-hidden">
                            <div
                                class="absolute -right-4 -top-4 w-24 h-24 bg-white/5 rounded-full blur-2xl group-hover:bg-white/10 transition-all">
                            </div>
                            <span
                                class="text-[10px] text-white/60 uppercase font-bold tracking-wider mb-2 block flex justify-between">
                                Triple-Trust Readiness
                                <span class="font-mono text-emerald-400"
                                    x-text="trustPosture.compliance_health + '%'"></span>
                            </span>

                            <div class="grid grid-cols-3 gap-2 mt-2">
                                <div class="bg-black/20 p-2 rounded border border-white/5 text-center">
                                    <div class="text-[8px] text-white/40 uppercase mb-1">Identity</div>
                                    <i data-lucide="shield-check"
                                        :class="trustPosture.layers?.transport.status === 'ok' ? 'text-emerald-400' : 'text-red-400'"
                                        class="w-4 h-4 mx-auto"></i>
                                </div>
                                <div class="bg-black/20 p-2 rounded border border-white/5 text-center">
                                    <div class="text-[8px] text-white/40 uppercase mb-1">Privacy</div>
                                    <i data-lucide="lock"
                                        :class="trustPosture.layers?.privacy.status === 'ok' ? 'text-emerald-400' : 'text-red-400'"
                                        class="w-4 h-4 mx-auto"></i>
                                </div>
                                <div class="bg-black/20 p-2 rounded border border-white/5 text-center">
                                    <div class="text-[8px] text-white/40 uppercase mb-1">Quantum</div>
                                    <i data-lucide="cpu"
                                        :class="trustPosture.layers?.integrity.status === 'ok' ? 'text-sky-400' : 'text-red-400'"
                                        class="w-4 h-4 mx-auto"></i>
                                </div>
                            </div>

                            <div class="mt-3 flex items-center justify-between">
                                <div class="flex flex-wrap gap-1">
                                    <span class="badge badge-success text-[7px] py-0 px-1">Dilithium-3</span>
                                    <span class="badge badge-success text-[7px] py-0 px-1">mTLS-HMAC</span>
                                </div>
                                <div class="text-[9px] font-bold text-white/60 uppercase"
                                    x-text="trustPosture.threat_environment"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Lineage Chart Section -->
                    <div class="grid grid-cols-3 gap-6 mb-10">
                        <div class="plm-card col-span-2">
                            <h4 class="text-sm font-semibold mb-4 flex items-center gap-2 text-white/80">
                                <i data-lucide="bar-chart-3" class="w-4 h-4 text-sky-400"></i>
                                Recent Run Scores
                            </h4>
                            <div class="h-48">
                                <canvas id="lineageChart"></canvas>
                            </div>
                        </div>
                        <div class="plm-card">
                            <h4 class="text-sm font-semibold mb-4 flex items-center gap-2 text-white/80">
                                <i data-lucide="activity" class="w-4 h-4 text-emerald-400"></i>
                                Threat Environment
                            </h4>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-white/40">Global Posture</span>
                                    <span
                                        :class="trustPosture.threat_environment === 'STABLE' ? 'text-emerald-400' : 'text-amber-400'"
                                        class="font-mono text-sm font-bold"
                                        x-text="trustPosture.threat_environment"></span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-white/40">At Risk Fleets</span>
                                    <span class="font-mono text-sm text-red-400"
                                        x-text="trustPosture.at_risk_fleets"></span>
                                </div>
                                <div class="flex justify-between items-center border-t border-white/5 pt-3">
                                    <span class="text-xs text-white/40">Audit Events</span>
                                    <span class="font-mono text-sm" x-text="auditLogs.length"></span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-white/40">Renewal Jobs</span>
                                    <span class="font-mono text-sm" x-text="identityJobs.length"></span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-white/40">PQC Integrity</span>
                                    <span
                                        class="text-[10px] text-sky-400 px-1.5 py-0.5 bg-sky-500/10 rounded uppercase font-bold">Verified</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold mb-6 flex items-center gap-2">
                        <i data-lucide="activity" class="text-sky-500 w-5 h-5"></i> System Activity Proof
                        <template x-if="loading.jobs">
                            <span class="ml-2 text-xs text-white/30 animate-pulse">Loading...</span>
                        </template>
                    </h3>

                    <div class="plm-card">
                        <!-- Error State -->
                        <template x-if="errors.jobs">
                            <div class="flex flex-col items-center justify-center py-12 text-center">
                                <div class="w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center mb-4">
                                    <i data-lucide="alert-triangle" class="w-6 h-6 text-red-400"></i>
                                </div>
                                <p class="text-white/60 text-sm">Failed to load activity data</p>
                                <p class="text-white/30 text-xs mt-1" x-text="errors.jobs"></p>
                                <button @click="fetchJobs()"
                                    class="mt-4 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-xs transition-colors">
                                    Retry
                                </button>
                            </div>
                        </template>

                        <!-- Loading Skeleton -->
                        <template x-if="loading.jobs && !errors.jobs">
                            <div class="space-y-4">
                                <template x-for="i in 5">
                                    <div class="flex items-center gap-4">
                                        <div class="skeleton h-4 w-20"></div>
                                        <div class="skeleton h-4 w-32"></div>
                                        <div class="skeleton h-4 w-40"></div>
                                        <div class="skeleton h-4 w-24"></div>
                                        <div class="skeleton h-4 w-16"></div>
                                    </div>
                                </template>
                            </div>
                        </template>

                        <!-- Empty State -->
                        <template x-if="!loading.jobs && !errors.jobs && jobs.length === 0">
                            <div class="flex flex-col items-center justify-center py-12 text-center">
                                <div class="w-12 h-12 rounded-full bg-white/5 flex items-center justify-center mb-4">
                                    <i data-lucide="inbox" class="w-6 h-6 text-white/20"></i>
                                </div>
                                <p class="text-white/40 text-sm">No activity recorded yet</p>
                                <p class="text-white/20 text-xs mt-1">Run an enablement job to see activity here</p>
                            </div>
                        </template>

                        <!-- Data Table -->
                        <template x-if="!loading.jobs && !errors.jobs && jobs.length > 0">
                            <table class="w-full text-left text-sm">
                                <thead>
                                    <tr class="text-white/40 border-b border-white/5">
                                        <th class="pb-3 font-medium">Trace ID</th>
                                        <th class="pb-3 font-medium">Model Type</th>
                                        <th class="pb-3 font-medium">Audit Proof</th>
                                        <th class="pb-3 font-medium">Time</th>
                                        <th class="pb-3 font-medium">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-white/5">
                                    <template x-for="job in jobs" :key="job.id">
                                        <tr class="hover:bg-white/[0.02] transition-all group cursor-pointer">
                                            <td class="py-4 font-mono text-xs text-sky-400/80"
                                                x-text="job.id.substring(0,8)">
                                            </td>
                                            <td class="py-4">
                                                <div class="flex items-center gap-2">
                                                    <div
                                                        class="w-2 h-2 rounded-full bg-sky-500 group-hover:animate-pulse">
                                                    </div>
                                                    <span x-text="job.type"></span>
                                                </div>
                                            </td>
                                            <td class="py-4">
                                                <span
                                                    class="text-[10px] font-mono text-white/30 truncate max-w-[150px] inline-block hover:text-white/60 transition-colors"
                                                    x-text="job.api_key_hash"></span>
                                            </td>
                                            <td class="py-4 text-white/40 text-xs"
                                                x-text="formatRelativeTime(job.created_at)"></td>
                                            <td class="py-4">
                                                <span
                                                    :class="getStatusBg(job.status) + ' ' + getStatusColor(job.status)"
                                                    class="px-2 py-1 rounded-full text-[10px] font-medium"
                                                    x-text="job.status"></span>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </template>
                    </div>
                </div>

                <!-- Lineage Tab -->
                <div x-show="activeTab === 'lineage'" x-transition x-cloak>
                    <h3 class="text-lg font-semibold mb-6 flex items-center gap-2">
                        <i data-lucide="git-branch" class="text-sky-500 w-5 h-5"></i> Model Lineage & Runs
                        <template x-if="loading.runs">
                            <span class="ml-2 text-xs text-white/30 animate-pulse">Loading...</span>
                        </template>
                    </h3>

                    <div class="plm-card">
                        <!-- Error State -->
                        <template x-if="errors.runs">
                            <div class="flex flex-col items-center justify-center py-12 text-center">
                                <div class="w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center mb-4">
                                    <i data-lucide="alert-triangle" class="w-6 h-6 text-red-400"></i>
                                </div>
                                <p class="text-white/60 text-sm">Failed to load lineage data</p>
                                <p class="text-white/30 text-xs mt-1" x-text="errors.runs"></p>
                                <button @click="fetchRuns()"
                                    class="mt-4 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-xs transition-colors">
                                    Retry
                                </button>
                            </div>
                        </template>

                        <!-- Loading Skeleton -->
                        <template x-if="loading.runs && !errors.runs">
                            <div class="space-y-4">
                                <template x-for="i in 5">
                                    <div class="flex items-center gap-4">
                                        <div class="skeleton h-4 w-24"></div>
                                        <div class="skeleton h-4 w-32"></div>
                                        <div class="skeleton h-4 w-20"></div>
                                        <div class="skeleton h-4 w-32"></div>
                                        <div class="skeleton h-4 w-16"></div>
                                    </div>
                                </template>
                            </div>
                        </template>

                        <!-- Empty State -->
                        <template x-if="!loading.runs && !errors.runs && runs.length === 0">
                            <div class="flex flex-col items-center justify-center py-12 text-center">
                                <div class="w-12 h-12 rounded-full bg-white/5 flex items-center justify-center mb-4">
                                    <i data-lucide="git-branch" class="w-6 h-6 text-white/20"></i>
                                </div>
                                <p class="text-white/40 text-sm">No runs recorded</p>
                                <p class="text-white/20 text-xs mt-1">Register a model run to see lineage data</p>
                            </div>
                        </template>

                        <!-- Data Table -->
                        <template x-if="!loading.runs && !errors.runs && runs.length > 0">
                            <table class="w-full text-left text-sm">
                                <thead>
                                    <tr class="text-white/40 border-b border-white/5">
                                        <th class="pb-3 font-medium">Run ID</th>
                                        <th class="pb-3 font-medium">Git Commit</th>
                                        <th class="pb-3 font-medium">SDK Version</th>
                                        <th class="pb-3 font-medium">Created At</th>
                                        <th class="pb-3 font-medium">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-white/5">
                                    <template x-for="run in runs" :key="run.run_id">
                                        <tr class="hover:bg-white/[0.02] transition-all hover-lift">
                                            <td class="py-4 font-mono text-xs text-white/80"
                                                x-text="run.run_id.substring(0,8)"></td>
                                            <td class="py-4 font-mono text-xs text-sky-400"
                                                x-text="run.git_commit ? run.git_commit.substring(0,7) : '-'"></td>
                                            <td class="py-4 text-xs font-mono text-white/60" x-text="run.sdk_version">
                                            </td>
                                            <td class="py-4 text-white/40 text-xs" x-text="formatDate(run.created_at)">
                                            </td>
                                            <td class="py-4">
                                                <span
                                                    :class="getStatusBg(run.status) + ' ' + getStatusColor(run.status)"
                                                    class="px-2 py-1 rounded-full text-[10px] font-medium"
                                                    x-text="run.status"></span>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </template>
                    </div>
                </div>

                <!-- Compliance Tab -->
                <div x-show="activeTab === 'compliance'" x-transition x-cloak>
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold">Enterprise Compliance Registry</h3>
                        <div class="flex gap-2">
                            <span class="badge badge-info text-[10px]">ISO 9001</span>
                            <span class="badge badge-info text-[10px]">SOC 2</span>
                            <span class="badge badge-info text-[10px]">GDPR</span>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-6 mb-10">
                        <div
                            class="plm-card border-emerald-500/20 hover:border-emerald-500/40 glow-emerald transition-all">
                            <h4 class="font-bold flex items-center gap-2 mb-4">
                                <i data-lucide="check-circle" class="text-emerald-500 w-4 h-4"></i> SOC 2 Type II
                            </h4>
                            <p class="text-xs text-white/50 leading-relaxed mb-4">Verification logs synchronized with
                                UKF Audit Ledger. Total controls mapped: 24/24.</p>
                            <div
                                class="flex justify-between items-center bg-white/5 p-3 rounded-lg border border-white/5">
                                <span class="text-[10px] font-mono text-white/40 uppercase">Last Verification</span>
                                <span class="text-xs font-semibold uppercase text-emerald-400 flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full bg-emerald-500 pulse-dot"></span>
                                    PASSED: 2026-01-01
                                </span>
                            </div>
                        </div>
                        <div
                            class="plm-card border-emerald-500/20 hover:border-emerald-500/40 glow-emerald transition-all">
                            <h4 class="font-bold flex items-center gap-2 mb-4">
                                <i data-lucide="shield" class="text-emerald-500 w-4 h-4"></i> TGSP Manifest Integrity
                            </h4>
                            <p class="text-xs text-white/50 leading-relaxed mb-4">Cryptographic pinning of container
                                layers active. All manifests verified against fleet CA.</p>
                            <div
                                class="flex justify-between items-center bg-white/5 p-3 rounded-lg border border-white/5">
                                <span class="text-[10px] font-mono text-white/40 uppercase">Active Profiles</span>
                                <span class="text-xs font-semibold uppercase text-emerald-400 flex items-center gap-2">
                                    <span class="w-2 h-2 rounded-full bg-emerald-500 pulse-dot"></span>
                                    <span x-text="tgspPackages.filter(p => p.status === 'verified').length"></span>
                                    Verified
                                </span>
                            </div>
                        </div>

                        <!-- NEW: EKU Split Migration Card -->
                        <div :class="certificates.some(c => c.has_eku_conflict) ? 'border-red-500/30' : 'border-white/10'"
                            class="plm-card transition-all col-span-2 mt-2">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="font-bold flex items-center gap-2 mb-2">
                                        <i data-lucide="split" class="text-sky-400 w-4 h-4"></i> Chrome 2026 EKU Split
                                        Readiness
                                    </h4>
                                    <p class="text-xs text-white/50 leading-relaxed mb-4">Automated migration to split
                                        public TLS and mTLS certificates. <a href="#"
                                            class="text-sky-400 underline">Learn more</a></p>
                                </div>
                                <button @click="executeEKUMigration()"
                                    :disabled="!certificates.some(c => c.has_eku_conflict)"
                                    class="bg-sky-600 hover:bg-sky-500 disabled:opacity-30 disabled:cursor-not-allowed px-4 py-2 rounded-lg text-xs font-bold transition-all shadow-lg shadow-sky-600/20">
                                    Trigger Migration
                                </button>
                            </div>

                            <template x-if="certificates.some(c => c.has_eku_conflict)">
                                <div
                                    class="bg-red-500/10 border border-red-500/20 p-3 rounded-lg flex items-center gap-3">
                                    <i data-lucide="alert-triangle"
                                        class="text-red-400 w-5 h-5 flex-shrink-0 animate-bounce"></i>
                                    <span class="text-xs text-red-200">
                                        Found <strong
                                            x-text="certificates.filter(c => c.has_eku_conflict).length"></strong>
                                        certificates with EKU conflicts.
                                        Manual action required before June 15, 2026.
                                    </span>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- NEW: Identity Renewal Monitor -->
                    <h4 class="text-sm font-semibold mb-4 flex items-center gap-2 text-white/80">
                        <i data-lucide="refresh-cw" class="w-4 h-4 text-sky-400"></i> Active Identity Renewals
                        <template x-if="loading.identity">
                            <span class="ml-2 text-xs text-white/30 animate-pulse">Polling...</span>
                        </template>
                    </h4>

                    <div class="plm-card mb-10">
                        <template x-if="identityJobs.length === 0">
                            <p class="text-center py-6 text-xs text-white/30 italic">No active renewal jobs</p>
                        </template>
                        <template x-if="identityJobs.length > 0">
                            <table class="w-full text-left text-xs">
                                <thead>
                                    <tr class="text-white/40 border-b border-white/5 pb-2">
                                        <th class="py-2">Job ID</th>
                                        <th class="py-2">Endpoint</th>
                                        <th class="py-2">Policy</th>
                                        <th class="py-2">Status</th>
                                        <th class="py-2">Progress</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-white/5">
                                    <template x-for="job in identityJobs" :key="job.id">
                                        <tr class="hover:bg-white/5">
                                            <td class="py-3 font-mono text-sky-400" x-text="job.id.substring(0,8)"></td>
                                            <td class="py-3 text-white/70" x-text="job.endpoint_id"></td>
                                            <td class="py-3 text-white/40" x-text="job.policy_id.substring(0,8)"></td>
                                            <td class="py-3">
                                                <span
                                                    :class="getStatusBg(job.status) + ' ' + getStatusColor(job.status)"
                                                    class="px-2 py-0.5 rounded-full text-[9px] font-bold uppercase tracking-tighter"
                                                    x-text="job.status"></span>
                                            </td>
                                            <td class="py-3">
                                                <div class="h-1 w-24 bg-white/5 rounded-full overflow-hidden">
                                                    <div class="h-full bg-sky-500 transition-all duration-1000"
                                                        :style="'width: ' + (job.status === 'succeeded' ? 100 : (job.status === 'failed' ? 10 : 50)) + '%'">
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </template>
                    </div>

                    <h4 class="text-sm font-semibold mb-4 flex items-center gap-2 text-white/80">
                        <i data-lucide="package" class="w-4 h-4 text-sky-400"></i> Registered Security Profiles (TGSP)
                        <template x-if="loading.tgsp">
                            <span class="ml-2 text-xs text-white/30 animate-pulse">Loading...</span>
                        </template>
                    </h4>

                    <div class="plm-card">
                        <!-- Error State -->
                        <template x-if="errors.tgsp">
                            <div class="flex flex-col items-center justify-center py-12 text-center">
                                <div class="w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center mb-4">
                                    <i data-lucide="alert-triangle" class="w-6 h-6 text-red-400"></i>
                                </div>
                                <p class="text-white/60 text-sm">Failed to load security profiles</p>
                                <p class="text-white/30 text-xs mt-1" x-text="errors.tgsp"></p>
                                <button @click="fetchTGSP()"
                                    class="mt-4 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-xs transition-colors">
                                    Retry
                                </button>
                            </div>
                        </template>

                        <!-- Loading Skeleton -->
                        <template x-if="loading.tgsp && !errors.tgsp">
                            <div class="space-y-4">
                                <template x-for="i in 3">
                                    <div class="flex items-center gap-4">
                                        <div class="skeleton h-4 w-32"></div>
                                        <div class="skeleton h-4 w-24"></div>
                                        <div class="skeleton h-4 w-40"></div>
                                        <div class="skeleton h-4 w-24"></div>
                                        <div class="skeleton h-4 w-16"></div>
                                    </div>
                                </template>
                            </div>
                        </template>

                        <!-- Empty State -->
                        <template x-if="!loading.tgsp && !errors.tgsp && tgspPackages.length === 0">
                            <div class="flex flex-col items-center justify-center py-12 text-center">
                                <div class="w-12 h-12 rounded-full bg-white/5 flex items-center justify-center mb-4">
                                    <i data-lucide="package" class="w-6 h-6 text-white/20"></i>
                                </div>
                                <p class="text-white/40 text-sm">No security profiles registered</p>
                            </div>
                        </template>

                        <!-- Data Table -->
                        <template x-if="!loading.tgsp && !errors.tgsp && tgspPackages.length > 0">
                            <table class="w-full text-left text-sm">
                                <thead>
                                    <tr class="text-white/40 border-b border-white/5">
                                        <th class="pb-3 font-medium">Package ID</th>
                                        <th class="pb-3 font-medium">Producer</th>
                                        <th class="pb-3 font-medium">Policy Match</th>
                                        <th class="pb-3 font-medium">Verified On</th>
                                        <th class="pb-3 font-medium">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-white/5">
                                    <template x-for="pkg in tgspPackages" :key="pkg.id">
                                        <tr class="hover:bg-white/[0.02] transition-all hover-lift">
                                            <td class="py-4 font-mono text-xs text-white/80"
                                                x-text="pkg.id.substring(0,12)"></td>
                                            <td class="py-4 text-xs text-white/60" x-text="pkg.producer_id"></td>
                                            <td class="py-4">
                                                <div class="flex flex-col">
                                                    <span class="text-xs font-medium text-sky-400"
                                                        x-text="pkg.policy_id"></span>
                                                    <span class="text-[10px] font-mono text-white/30"
                                                        x-text="'v' + pkg.policy_version"></span>
                                                </div>
                                            </td>
                                            <td class="py-4 text-white/40 text-xs"
                                                x-text="new Date(pkg.created_at).toLocaleDateString()"></td>
                                            <td class="py-4">
                                                <span
                                                    :class="getStatusBg(pkg.status) + ' ' + getStatusColor(pkg.status)"
                                                    class="px-2 py-1 rounded-full text-[10px] font-medium"
                                                    x-text="pkg.status"></span>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </template>
                    </div>
                </div>

                <!-- Key Vault Tab -->
                <div x-show="activeTab === 'vault'" x-transition x-cloak>
                    <h3 class="text-lg font-semibold mb-6 flex items-center gap-2">
                        <i data-lucide="key" class="text-sky-500 w-5 h-5"></i> Machine Identity Vault
                        <template x-if="loading.inventory">
                            <span class="ml-2 text-xs text-white/30 animate-pulse">Loading...</span>
                        </template>
                    </h3>

                    <div class="plm-card">
                        <!-- Error State -->
                        <template x-if="errors.inventory">
                            <div class="flex flex-col items-center justify-center py-12 text-center">
                                <div class="w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center mb-4">
                                    <i data-lucide="alert-triangle" class="w-6 h-6 text-red-400"></i>
                                </div>
                                <p class="text-white/60 text-sm">Failed to load identity vault</p>
                                <p class="text-white/30 text-xs mt-1" x-text="errors.inventory"></p>
                                <button @click="fetchInventory()"
                                    class="mt-4 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-xs transition-colors">
                                    Retry
                                </button>
                            </div>
                        </template>

                        <!-- Loading Skeleton -->
                        <template x-if="loading.inventory && !errors.inventory">
                            <div class="space-y-4">
                                <template x-for="i in 5">
                                    <div class="flex items-center gap-4">
                                        <div class="skeleton h-4 w-40"></div>
                                        <div class="skeleton h-4 w-32"></div>
                                        <div class="skeleton h-4 w-32"></div>
                                        <div class="skeleton h-4 w-24"></div>
                                    </div>
                                </template>
                            </div>
                        </template>

                        <!-- Empty State -->
                        <template x-if="!loading.inventory && !errors.inventory && certificates.length === 0">
                            <div class="flex flex-col items-center justify-center py-12 text-center">
                                <div class="w-12 h-12 rounded-full bg-white/5 flex items-center justify-center mb-4">
                                    <i data-lucide="key" class="w-6 h-6 text-white/20"></i>
                                </div>
                                <p class="text-white/40 text-sm">Vault empty</p>
                                <p class="text-white/20 text-xs mt-1">No machine identities found</p>
                            </div>
                        </template>

                        <!-- Data Table -->
                        <template x-if="!loading.inventory && !errors.inventory && certificates.length > 0">
                            <table class="w-full text-left text-sm">
                                <thead>
                                    <tr class="text-white/40 border-b border-white/5">
                                        <th class="pb-3 font-medium">Subject DN</th>
                                        <th class="pb-3 font-medium">Issuer</th>
                                        <th class="pb-3 font-medium">Conf</th>
                                        <th class="pb-3 font-medium">Expires</th>
                                        <th class="pb-3 font-medium">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-white/5">
                                    <template x-for="cert in certificates" :key="cert.id">
                                        <tr class="hover:bg-white/[0.02] transition-all hover-lift">
                                            <td class="py-4 text-xs font-mono text-white/80" x-text="cert.subject"></td>
                                            <td class="py-4 text-xs text-white/50" x-text="cert.issuer"></td>
                                            <td class="py-4">
                                                <template x-if="cert.has_eku_conflict">
                                                    <div class="w-4 h-4 text-red-400" title="EKU Split Required">
                                                        <i data-lucide="alert-triangle" class="w-4 h-4"></i>
                                                    </div>
                                                </template>
                                                <template x-if="!cert.has_eku_conflict">
                                                    <i data-lucide="check" class="text-emerald-400/30 w-4 h-4"></i>
                                                </template>
                                            </td>
                                            <td class="py-4 text-xs text-white/50"
                                                x-text="new Date(cert.not_after).toLocaleDateString()"></td>
                                            <td class="py-4">
                                                <span :class="getCertExpiryClass(cert.days_to_expiry)"
                                                    class="px-2 py-1 rounded-full text-[10px] font-bold"
                                                    x-text="cert.days_to_expiry + ' days'"></span>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </template>
                    </div>
                </div>

                <!-- Audit Tab -->
                <div x-show="activeTab === 'audit'" x-transition x-cloak>
                    <h3 class="text-lg font-semibold mb-6 flex items-center gap-2">
                        <i data-lucide="clipboard-list" class="text-sky-500 w-5 h-5"></i> Tamper-Proof Audit Trail
                        <template x-if="loading.audit">
                            <span class="ml-2 text-xs text-white/30 animate-pulse">Loading...</span>
                        </template>
                    </h3>

                    <div class="plm-card">
                        <!-- Error State -->
                        <template x-if="errors.audit">
                            <div class="flex flex-col items-center justify-center py-12 text-center">
                                <div class="w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center mb-4">
                                    <i data-lucide="alert-triangle" class="w-6 h-6 text-red-400"></i>
                                </div>
                                <p class="text-white/60 text-sm">Failed to load audit logs</p>
                                <p class="text-white/30 text-xs mt-1" x-text="errors.audit"></p>
                                <button @click="fetchAudit()"
                                    class="mt-4 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-xs transition-colors">
                                    Retry
                                </button>
                            </div>
                        </template>

                        <!-- Loading Skeleton -->
                        <template x-if="loading.audit && !errors.audit">
                            <div class="space-y-4">
                                <template x-for="i in 8">
                                    <div class="flex items-center gap-4">
                                        <div class="skeleton h-4 w-32"></div>
                                        <div class="skeleton h-4 w-24"></div>
                                        <div class="skeleton h-4 w-20"></div>
                                        <div class="skeleton h-4 w-40"></div>
                                        <div class="skeleton h-4 w-16"></div>
                                    </div>
                                </template>
                            </div>
                        </template>

                        <!-- Empty State -->
                        <template x-if="!loading.audit && !errors.audit && auditLogs.length === 0">
                            <div class="flex flex-col items-center justify-center py-12 text-center">
                                <div class="w-12 h-12 rounded-full bg-white/5 flex items-center justify-center mb-4">
                                    <i data-lucide="clipboard-list" class="w-6 h-6 text-white/20"></i>
                                </div>
                                <p class="text-white/40 text-sm">Audit trail empty</p>
                                <p class="text-white/20 text-xs mt-1">Security events will appear here</p>
                            </div>
                        </template>

                        <!-- Data Table -->
                        <template x-if="!loading.audit && !errors.audit && auditLogs.length > 0">
                            <table class="w-full text-left text-sm">
                                <thead>
                                    <tr class="text-white/40 border-b border-white/5">
                                        <th class="pb-3 font-medium">Timestamp</th>
                                        <th class="pb-3 font-medium">Actor</th>
                                        <th class="pb-3 font-medium">Action</th>
                                        <th class="pb-3 font-medium">Target</th>
                                        <th class="pb-3 font-medium">Hash</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-white/5">
                                    <template x-for="log in auditLogs" :key="log.id">
                                        <tr class="hover:bg-white/[0.02] transition-all hover-lift">
                                            <td class="py-4 text-xs text-white/40" x-text="formatDate(log.timestamp)">
                                            </td>
                                            <td class="py-4">
                                                <div class="flex flex-col">
                                                    <span class="text-xs font-bold text-sky-400"
                                                        x-text="log.actor_type"></span>
                                                    <span
                                                        class="text-[10px] text-white/30 truncate max-w-[100px] font-mono"
                                                        x-text="log.actor_id"></span>
                                                </div>
                                            </td>
                                            <td class="py-4">
                                                <span class="badge badge-info" x-text="log.action"></span>
                                            </td>
                                            <td class="py-4 text-xs font-mono text-white/60"
                                                x-text="log.target_type + ':' + log.target_id"></td>
                                            <td class="py-4 text-[10px] font-mono text-white/20 truncate max-w-[80px]"
                                                x-text="log.entry_hash"></td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </template>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // Re-initialize icons after Alpine renders
        document.addEventListener('alpine:initialized', () => {
            lucide.createIcons();
        });

        // Re-run icons when tabs change
        window.addEventListener('tab-changed', () => {
            lucide.createIcons();
        });
    </script>
</body>

</html>